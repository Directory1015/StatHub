<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StatSnap — Home</title>
  <meta name="description" content="StatSnap — tap a league circle to view and share current player leaders." />
  <style>
    :root{
      --bg:#0b0d12; --panel:#111724; --panel2:#0f1522; 
      --tx:#e8edf7; --tx-dim:#a6b0c3; --divider:#27324a;
      --maxw:1200px; --brand:#5aa2ff;
      --shadow:0 8px 26px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1400px 700px at 50% -12%, rgba(90,162,255,.18), transparent 70%),
        radial-gradient(1000px 620px at 88% 8%, rgba(0,210,255,.12), transparent 65%),
        var(--bg);
      color:var(--tx);
    }

    header{text-align:center; padding:44px 14px 18px}
    h1{margin:0 0 8px; font-size:clamp(32px,5vw,44px); text-shadow:0 0 14px rgba(90,162,255,.4)}
    .tag{color:var(--tx-dim); font-size:14px}

    .shell{max-width:var(--maxw); margin:0 auto; padding:24px 20px 40px}
    .grid{
      display:grid; gap:26px;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      justify-content:center; justify-items:center; align-items:start;
    }
    @media (max-width: 900px){ .grid{ grid-template-columns:repeat(3,minmax(0,1fr)); } }
    @media (max-width: 640px){ .grid{ grid-template-columns:repeat(2,minmax(0,1fr)); } }

    /* circle tiles */
    .tile{
      --accent:#5aa2ff;
      width:140px; height:140px; border-radius:50%;
      background:linear-gradient(180deg,#111724,#0f1522);
      border:2px solid var(--divider);
      box-shadow:var(--shadow);
      display:flex; align-items:center; justify-content:center; flex-direction:column;
      cursor:pointer; transition:.2s; position:relative; color:inherit;
      touch-action:manipulation;
    }
    @media (prefers-reduced-motion:reduce){ .tile{transition:none} }
    .tile:hover{
      transform: translateY(-6px) scale(1.05);
      border-color:var(--accent);
      box-shadow:0 14px 30px rgba(0,0,0,.45), 0 0 16px color-mix(in oklab, var(--accent) 45%, transparent);
    }

    .logoBox{
      width:70px; height:70px; margin-bottom:8px; display:grid; place-items:center; border-radius:50%;
      background:#0e1422; border:1px solid var(--divider); box-shadow:inset 0 0 18px rgba(90,162,255,.15);
      overflow:hidden;
    }
    .logoImg{ max-width:64px; max-height:64px; width:auto; height:auto; object-fit:contain; display:block; filter:drop-shadow(0 2px 4px rgba(0,0,0,.45)) }
    .logoEmoji{ font-size:40px; line-height:1; display:none }
    .tileName{ font-weight:900; font-size:14px; text-align:center }

    .tile[data-key="epl"]{--accent:#5c2d91}
    .tile[data-key="laliga"]{--accent:#ea1d2c}
    .tile[data-key="seriea"]{--accent:#0e5adf}
    .tile[data-key="bundesliga"]{--accent:#d0021b}
    .tile[data-key="ligue1"]{--accent:#cedc00}
    .tile[data-key="ucl"]{--accent:#1b2d6b}

    /* modal */
    .overlay{position:fixed; inset:0; background:rgba(0,0,0,.70); display:none; align-items:center; justify-content:center; z-index:200}
    .overlay.active{display:flex}
    .modal{ --accent:#5aa2ff; width:min(700px,92vw); max-height:90vh; overflow:auto;
      background:linear-gradient(180deg,#111724,#0f1522); border:1px solid var(--divider); border-radius:20px;
      box-shadow:0 24px 60px rgba(0,0,0,.6); animation:zoomIn .28s ease; position:relative }
    @keyframes zoomIn{from{opacity:0; transform:scale(.9)} to{opacity:1; transform:scale(1)}}
    .modal[data-key="epl"]{--accent:#5c2d91}.modal[data-key="laliga"]{--accent:#ea1d2c}.modal[data-key="seriea"]{--accent:#0e5adf}
    .modal[data-key="bundesliga"]{--accent:#d0021b}.modal[data-key="ligue1"]{--accent:#cedc00}.modal[data-key="ucl"]{--accent:#1b2d6b}
    .mHd{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:16px 18px; border-bottom:1px solid var(--divider);
      position:sticky; top:0; background:linear-gradient(180deg, rgba(255,255,255,.03), transparent); backdrop-filter:blur(6px); z-index:2}
    .mTitle{font-weight:900; font-size:18px; display:flex; align-items:center; gap:10px}
    .mDot{width:10px; height:10px; border-radius:50%; background:var(--accent); box-shadow:0 0 10px color-mix(in oklab, var(--accent) 60%, transparent)}
    .mMeta{color:var(--tx-dim); font-size:12px; font-weight:700}
    .mClose{background:none; border:1px solid var(--divider); color:var(--tx); font-size:18px; border-radius:10px; padding:6px 10px; cursor:pointer}
    .mClose:hover{border-color:var(--accent)}
    .record{padding:12px 18px; border-bottom:1px dashed var(--divider); color:var(--tx-dim); font-size:13px; line-height:1.5}
    .record b{color:#ffd76a; text-shadow:0 0 10px rgba(255,215,106,.25)}
    .cols{display:grid; gap:18px; padding:16px 18px 6px}
    .col h4{margin:0 0 8px; font-size:14px; letter-spacing:.2px; color:var(--tx); position:relative; padding-left:10px}
    .col h4::before{content:""; position:absolute; left:0; top:50%; transform:translateY(-50%); width:4px; height:14px; border-radius:2px;
      background:var(--accent); box-shadow:0 0 10px color-mix(in oklab, var(--accent) 60%, transparent)}
    .list{list-style:none; margin:0; padding:0; display:grid; gap:8px}
    .row{display:grid; grid-template-columns:26px 1fr auto; gap:10px; align-items:center; padding:8px 10px; border:1px solid var(--divider);
      border-radius:12px; background:#121a2a}
    .row:hover{border-color:#33405b; background:#182034}
    .idx{width:24px; height:24px; border-radius:50%; display:grid; place-items:center; font-weight:900; color:#aeb7cc;
      background:rgba(255,255,255,.05); border:1px solid var(--divider)}
    .nm{font-weight:800; font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .val{font-weight:900; font-size:13px; color:#cfe2ff; padding:2px 10px; border-radius:999px; border:1px solid var(--divider);
      background:#0f1522; min-width:34px; text-align:center}
    .row:first-child .idx{background:linear-gradient(180deg,#2a2230,#3a2a12); border-color:#6b5320; color:#ffd76a}
    .row:first-child .nm::before{content:"👑 "}

    /* share bar */
    .shareBar{display:flex; gap:10px; flex-wrap:wrap; padding:12px 18px 16px; border-top:1px solid var(--divider)}
    .btn{display:inline-flex; align-items:center; gap:8px; background:#121a2a; border:1px solid var(--divider); color:var(--tx);
      padding:8px 10px; border-radius:10px; font-weight:700; font-size:13px; cursor:pointer; touch-action:manipulation}
    .btn:hover{border-color:var(--brand)}
    .shareLinks{display:flex; gap:10px; padding:0 18px 18px}
    .shareLinks a{font-size:13px; color:#cfe2ff; text-decoration:none; border:1px solid var(--divider); padding:6px 8px; border-radius:8px}
    .shareLinks a:hover{border-color:var(--brand)}
    footer{text-align:center; color:#a6b0c3; padding:20px; font-size:12px; border-top:1px solid rgba(255,255,255,.05)}
    
    /* export card (for jpeg capture) */
    .shareCard{
      width:1080px; padding:36px 36px 28px; border-radius:24px; 
      background: radial-gradient(1200px 600px at 50% -10%, rgba(90,162,255,.18), transparent 60%), #0b0d12;
      color:#e8edf7; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; border:2px solid #27324a;
    }
    .shareCard .top{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
    .shareCard .league{display:flex; align-items:center; gap:14px; font-weight:900; font-size:40px}
    .shareCard .logo{width:72px; height:72px; border-radius:50%; display:grid; place-items:center; background:#0e1422; border:1px solid #27324a; overflow:hidden}
    .shareCard .logo img{max-width:64px; max-height:64px}
    .shareCard .date{color:#a6b0c3; font-weight:700}
    .shareCard .rec{margin:8px 0 18px; color:#a6b0c3; font-size:24px}
    .shareCard .rec b{color:#ffd76a}
    .shareCard .cols{display:grid; gap:18px; grid-template-columns:1fr 1fr}
    .shareCard h3{margin:0 0 10px; font-size:26px; color:#cfe2ff}
    .shareCard ol{list-style:none; margin:0; padding:0; display:grid; gap:10px}
    .shareCard li{display:grid; grid-template-columns:40px 1fr 60px; gap:12px; align-items:center; background:#121a2a; border:1px solid #27324a; border-radius:12px; padding:10px 12px}
    .shareCard .i{width:34px; height:34px; display:grid; place-items:center; border-radius:50%; background:#0f1522; color:#a6b0c3; font-weight:900}
    .shareCard .name{font-weight:800; font-size:22px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .shareCard .v{font-weight:900; font-size:22px; color:#cfe2ff; text-align:center}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
</head>
<body>
  <header>
    <h1>StatSnap</h1>
    <p class="tag">Tap a league circle to view current <b>player</b> leaders. Share them as an image.</p>
  </header>

  <main class="shell">
    <div id="tiles" class="grid" aria-live="polite"></div>
  </main>

  <!-- Modal -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div id="modal" class="modal">
      <div class="mHd">
        <div class="mTitle"><span class="mDot"></span><span id="mLeague">League</span></div>
        <div class="mMeta" id="mDate"></div>
        <button class="mClose" id="mClose" aria-label="Close">×</button>
      </div>
      <div class="record" id="mRecord"></div>
      <div class="cols">
        <section class="col">
          <h4>Current Top Scorers</h4>
          <ol class="list" id="mScorers"></ol>
        </section>
        <section class="col">
          <h4>Current Top Assisters</h4>
          <ol class="list" id="mAssisters"></ol>
        </section>
      </div>

      <div class="shareBar">
        <button class="btn" id="btnSave"><span>📷</span> Save JPG</button>
        <button class="btn" id="btnShare"><span>📤</span> Share Image</button>
        <button class="btn" id="btnCopyLink"><span>🔗</span> Copy Link</button>
        <span id="shareStatus" style="color:#a6f3c3; font-size:12px; font-weight:700"></span>
      </div>
      <div class="shareLinks">
        <a id="linkX" target="_blank" rel="noopener">Share on X</a>
        <a id="linkFB" target="_blank" rel="noopener">Facebook</a>
        <a id="linkWA" target="_blank" rel="noopener">WhatsApp</a>
        <a id="linkTG" target="_blank" rel="noopener">Telegram</a>
      </div>
    </div>
  </div>

  <!-- Fallback JSON (if leaders.json fails) -->
  <script type="application/json" id="leaders-fallback">
  {"updated":"2025-09-28","competitions":[
    {"key":"epl","name":"Premier League","record":{"holder":"Erling Haaland","goals":"36","season":"2022/23"},
      "scorers":[{"name":"Erling Haaland (Man City)","value":"8"},{"name":"Antoine Semenyo (Bournemouth)","value":"4"},{"name":"Jaidon Anthony (Burnley)","value":"4"}],
      "assisters":[{"name":"Jack Grealish (Everton)","value":"4"},{"name":"Mohammed Kudus (Tottenham Hotspur)","value":"4"},{"name":"El Hadji Malick Diouf (West Ham United)","value":"3"}]},
    {"key":"laliga","name":"La Liga","record":{"holder":"Lionel Messi","goals":"50","season":"2011/12"},
      "scorers":[{"name":"Kylian Mbappé (Real Madrid)","value":"8"},{"name":"Julián Álvarez (Atl. Madrid)","value":"6"},{"name":"Etta Eyong (Levante)","value":"4"}],
      "assisters":[{"name":"Vinícius Júnior (Real Madrid)","value":"4"},{"name":"Luis Milla (Getafe)","value":"4"},{"name":"Lamine Yamal (Barcelona)","value":"3"}]},
    {"key":"seriea","name":"Serie A","record":{"holder":"Ciro Immobile","goals":"36","season":"2019/20"},
      "scorers":[{"name":"Christian Pulisic (AC Milan)","value":"4"},{"name":"Nico Paz (Como)","value":"3"},{"name":"Marcus Thuram (Inter)","value":"3"}],
      "assisters":[{"name":"Kenan Yıldız (Juventus Turin)","value":"3"},{"name":"Nico Paz (Como 1907)","value":"3"},{"name":"Nikola Krstović (Atalanta Bergamo)","value":"3"}]},
    {"key":"bundesliga","name":"Bundesliga","record":{"holder":"Robert Lewandowski","goals":"41","season":"2020/21"},
      "scorers":[{"name":"Harry Kane (Bayern Munich)","value":"10"},{"name":"Can Uzun (Eintracht Frankfurt)","value":"5"},{"name":"Fisnik Asllani (Hoffenheim)","value":"4"}],
      "assisters":[{"name":"Andrej Ilic (1. FC Union Berlin)","value":"4"},{"name":"Samuel Mbangula (SV Werder Bremen)","value":"3"},{"name":"Ritsu Doan (Eintracht Frankfurt)","value":"3"}]},
    {"key":"ligue1","name":"Ligue 1","record":{"holder":"Kylian Mbappé","goals":"27","season":"2018/19"},
      "scorers":[{"name":"Ansu Fati (Monaco)","value":"3"},{"name":"Pierre-Emerick Aubameyang (Marseille)","value":"3"},{"name":"Bradley Barcola (PSG)","value":"3"}],
      "assisters":[{"name":"Ludovic Ajorque (Stade Brest 29)","value":"4"},{"name":"Dilane Bakwa (RC Strasbourg Alsace)","value":"3"},{"name":"Félix Correia (LOSC Lille)","value":"3"}]},
    {"key":"ucl","name":"UEFA Champions League","record":{"holder":"Cristiano Ronaldo","goals":"17","season":"2013/14"},
      "scorers":[{"name":"Kylian Mbappé (Real Madrid)","value":"5"},{"name":"Francisco Trincão (Sporting CP)","value":"2"},{"name":"Marcos Llorente (Atlético Madrid)","value":"2"}],
      "assisters":[{"name":"Lukáš Provod (Slavia Praha)","value":"2"},{"name":"Hakan Çalhanoğlu (Inter Milan)","value":"2"},{"name":"Lamine Yamal (Barcelona)","value":"1"}]}
  ]}
  </script>

  <script>
    const $ = (s, r=document)=>r.querySelector(s);

    /* Logos */
    const LOGOS = {
      epl:        { src: 'assets/epl.png',        fallback: '🇬🇧', alt: 'Premier League logo' },
      laliga:     { src: 'assets/laliga.png',     fallback: '🇪🇸', alt: 'La Liga logo' },
      seriea:     { src: 'assets/seriea.png',     fallback: '🇮🇹', alt: 'Serie A logo' },
      bundesliga: { src: 'assets/bundesliga.png', fallback: '🇩🇪', alt: 'Bundesliga logo' },
      ligue1:     { src: 'assets/ligue1.png',     fallback: '🇫🇷', alt: 'Ligue 1 logo' },
      ucl:        { src: 'assets/ucl.png',        fallback: '⭐',   alt: 'UEFA Champions League logo' }
    };

    async function getData(){
      try{
        const res = await fetch('leaders.json?v='+Date.now(), {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const j = await res.json();
        if(!j || !Array.isArray(j.competitions)) throw new Error('Malformed JSON');
        return j;
      }catch(e){
        const fallback = $('#leaders-fallback');
        return JSON.parse(fallback.textContent);
      }
    }

    function renderTiles(DATA){
      const wrap = $('#tiles');
      const bust = Date.now();
      wrap.innerHTML = DATA.competitions.map(c => {
        const logo = LOGOS[c.key] || { src:'', fallback:'🏆', alt:`${c.name} logo` };
        return `
          <button class="tile" data-key="${c.key}" aria-label="${c.name}" title="${c.name}">
            <div class="logoBox">
              <img class="logoImg" loading="lazy" decoding="async" src="${logo.src}?v=${bust}" alt="${logo.alt}">
              <span class="logoEmoji" aria-hidden="true">${logo.fallback}</span>
            </div>
            <div class="tileName">${c.name}</div>
          </button>
        `;
      }).join('');

      wrap.querySelectorAll('.tile').forEach(btn=>{
        const key = btn.getAttribute('data-key');
        const img = btn.querySelector('.logoImg');
        const emoji = btn.querySelector('.logoEmoji');

        img.addEventListener('error', ()=>{ img.style.display='none'; emoji.style.display='block'; });

        btn.addEventListener('click', ()=>{
          const league = DATA.competitions.find(x=>x.key===key);
          openModal(league, DATA.updated);
          updateShareLinks(key, league.name);
          history.replaceState(null, '', withLeagueParam(key));
        });
      });

      const urlKey = new URLSearchParams(location.search).get('league');
      if (urlKey) {
        const league = DATA.competitions.find(x=>x.key===urlKey);
        if (league) { openModal(league, DATA.updated); updateShareLinks(urlKey, league.name); }
      }
    }

    function listHTML(arr){
      return arr.map((p,i)=>`
        <li class="row">
          <span class="idx">${i+1}</span>
          <span class="nm">${p.name}</span>
          <span class="val">${p.value}</span>
        </li>
      `).join('');
    }

    function withLeagueParam(key){
      const u = new URL(location.href);
      u.searchParams.set('league', key);
      return u.toString();
    }

    function openModal(league, updated){
      const overlay = $('#overlay'); const modal = $('#modal');
      modal.setAttribute('data-key', league.key);
      $('#mLeague').textContent = league.name;
      $('#mDate').textContent = new Date(updated).toLocaleDateString();
      $('#mRecord').innerHTML = `
        <div>All-time single-season record: <b>${league.record.holder}</b></div>
        <div class="muted">• ${league.record.goals} goals • ${league.record.season}</div>
      `;
      $('#mScorers').innerHTML   = listHTML(league.scorers);
      $('#mAssisters').innerHTML = listHTML(league.assisters);

      const key = league.key;
      $('#btnSave').onclick  = ()=> exportShareCard(league, updated, 'download');
      $('#btnShare').onclick = ()=> exportShareCard(league, updated, 'share');
      $('#btnCopyLink').onclick = async ()=>{
        try{ await navigator.clipboard.writeText(withLeagueParam(key));
             $('#shareStatus').textContent='Link copied!'; setTimeout(()=>$('#shareStatus').textContent='',1600); }
        catch(e){ $('#shareStatus').textContent='Copy failed'; }
      };

      overlay.classList.add('active'); overlay.setAttribute('aria-hidden','false'); $('#mClose').focus();
    }

    function closeModal(){
      const overlay=$('#overlay');
      overlay.classList.remove('active');
      overlay.setAttribute('aria-hidden','true');
      const u = new URL(location.href); u.searchParams.delete('league'); history.replaceState(null,'',u);
    }

    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });
    $('#overlay').addEventListener('click', (e)=>{ if(e.target.id==='overlay') closeModal(); });
    $('#mClose').addEventListener('click', closeModal);

    function updateShareLinks(key, name){
      const url = encodeURIComponent(withLeagueParam(key));
      const text = encodeURIComponent(`${name} player leaders on StatSnap`);
      $('#linkX').href  = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
      $('#linkFB').href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
      $('#linkWA').href = `https://api.whatsapp.com/send?text=${text}%20${url}`;
      $('#linkTG').href = `https://t.me/share/url?url=${url}&text=${text}`;
    }

    /* === Image export (JPEG) with robust share fallbacks === */
    async function ensureHtml2Canvas(){
      if (window.html2canvas) return true;
      await new Promise((res,rej)=>{
        const s=document.createElement('script');
        s.src='https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
        s.onload=res; s.onerror=rej; document.head.appendChild(s);
      });
      return !!window.html2canvas;
    }

    async function exportShareCard(league, updated, mode){
      try{
        await ensureHtml2Canvas();

        // Build offscreen card
        const box=document.createElement('div');
        box.className='shareCard';
        const logo=LOGOS[league.key]?.src?`${LOGOS[league.key].src}?v=${Date.now()}`:'';
        const when=new Date(updated).toLocaleDateString();
        const makeList=arr=>arr.map((p,i)=>`
          <li><span class="i">${i+1}</span><span class="name">${p.name}</span><span class="v">${p.value}</span></li>
        `).join('');
        box.innerHTML=`
          <div class="top">
            <div class="league">
              <div class="logo">${logo?`<img src="${logo}" alt="">`:""}</div>
              <span>${league.name}</span>
            </div>
            <div class="date">${when}</div>
          </div>
          <div class="rec">All-time single-season record: <b>${league.record.holder}</b> • ${league.record.goals} goals • ${league.record.season}</div>
          <div class="cols">
            <div><h3>Top Scorers</h3><ol>${makeList(league.scorers)}</ol></div>
            <div><h3>Top Assisters</h3><ol>${makeList(league.assisters)}</ol></div>
          </div>`;
        box.style.position='fixed'; box.style.left='-20000px'; document.body.appendChild(box);

        const canvas=await html2canvas(box,{backgroundColor:'#0b0d12',scale:2,useCORS:true});
        box.remove();

        const blob=await new Promise(r=>canvas.toBlob(r,'image/jpeg',0.92));
        const fileName=`${league.key}-leaders.jpg`;

        if (mode==='download'){
          const url=URL.createObjectURL(blob);
          const a=document.createElement('a'); a.href=url; a.download=fileName; a.click(); URL.revokeObjectURL(url);
          $('#shareStatus').textContent='Saved!'; setTimeout(()=>$('#shareStatus').textContent='',1600);
          return;
        }

        // Try native share with file
        const file = new File([blob], fileName, {type:'image/jpeg'});
        try{
          if (navigator.canShare && navigator.canShare({files:[file]})) {
            await navigator.share({title:'StatSnap', text:`${league.name} leaders`, files:[file]});
            return;
          }
        }catch(_){} // ignore canShare quirks

        // Fallback: share the deep link (so Share button always does something)
        if (navigator.share){
          await navigator.share({ title:'StatSnap', text:`${league.name} leaders`, url: withLeagueParam(league.key) });
          return;
        }

        // Last resorts: copy to clipboard (if supported), else open image in new tab
        try{
          await navigator.clipboard.write([new ClipboardItem({'image/jpeg': blob})]);
          $('#shareStatus').textContent='Image copied — paste to chats!';
          setTimeout(()=>$('#shareStatus').textContent='',2000);
        }catch(e){
          const url=URL.createObjectURL(blob);
          window.open(url,'_blank'); // user can long-press & share
          setTimeout(()=>URL.revokeObjectURL(url),5000);
        }
      }catch(err){
        $('#shareStatus').textContent='Share failed';
        setTimeout(()=>$('#shareStatus').textContent='',2000);
        console.error(err);
      }
    }

    getData().then(renderTiles);
  </script>
</body>
</html>










